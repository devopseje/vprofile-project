pipeline {
       agent any
       tools {
        maven 'Maven3'
        jdk 'java8'
       }

       environment {
          SNAP_REPO = 'eje-vprofile-snapshot'
          NEXUS_USER = 'admin'
          NEXUS_PASS = 'Mastereje5'
          RELEASE_REPO = 'eje-vprofile-release'  
          CENTRAL_REPO = 'eje-vpro-maven-central'
          NEXUSIP = '172.31.43.164'
          NEXUSPORT = '8081'
          NEXUS_GRP_REPO = 'eje-vprofile-group'
          NEXUS_LOGIN = 'nexuslogin'
          SONARSERVER = 'sonarserver1'
          SONARSCANNER = 'sonarscanner'
            
       }


       stages {
            stage('build') {
               steps{
                    sh 'mvn clean  -DskipTests=true install'
               }
               post {
                    success {
                         echo 'Archiving .war datei'
                         archiveArtifacts artifacts: '**/*.war'
                    }
               }
               
            }

            stage('Test') {
               steps {
                    sh 'mvn test'
               }
            }
            stage('Checkstyle Analalyse') {
                    steps {
                         sh 'mvn checkstyle:checkstyle'
                    }
            }

            stage('Sonar Analalyse') {
               environment {
                    scannerHome = tool "${SONARSCANNER}"
               }
               steps {
                    withSonarQubeEnv("${SONARSERVER}"){
                         sh ''' ${scannerHome}/bin/sonar-scanner -Dsonar.projectKey=vprofile \
                         -Dsonar.projectName=vprofile \
                         -Dsonar.projectVersion=1.0 \
                         -Dsonar.source=src/ \
                         -Dsonar.java.binaries=target/test-classes/com/visualpathit/account/controllerTest/ \
                         -Dsonar.junit.reportsPath=target/surefire-reports/ \
                         -Dsonar.jacoco.reportsPath=target/jacoco.exec \
                         -Dsonar.java.checkstyle.reportsPath=target/checkstyle-result.xml
                         
                         '''
                    }
               }
            }
          }
       }
     
       
