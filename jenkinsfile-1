
def buildnummer = Jenkins.instance.getItem('cicd-jenkins-bean-stage').lastSuccessfulBuild.number

def COLOR_MAP = [
     'SUCCESS': 'good',
     'FAILURE': 'danger'
]
pipeline {
       agent any
       tools {
        maven 'Maven3'
        jdk 'java8'
       }

       environment {
          NEXUS_VERSION = "nexus3"
          NEXUS_PROTOCOL = "http"
          NEXUS_URL = "172.31.43.164:8081"
          NEXUS_REPOSITORY = "eje-vprofile-release"
          NEXUS_REPO_ID    = "eje-vprofile-release"
          NEXUS_CREDENTIAL_ID = "nexuslogin"
          ARTVERSION = "${env.BUILD_ID}"
          

        //  SNAP_REPO = 'eje-vprofile-snapshot'
       //   NEXUS_USER = 'admin'
      //    NEXUS_PASS = 'Mastereje5'
      //    RELEASE_REPO = 'eje-vprofile-release'  
      //    CENTRAL_REPO = 'eje-vpro-maven-central'
      //    NEXUSIP = '172.31.43.164'
      //    NEXUSPORT = '8081'
      //    NEXUS_GRP_REPO = 'eje-vprofile-group'
      //    NEXUS_LOGIN = 'nexuslogin'
          SONARSERVER = 'sonarserver1'
          SONARSCANNER = 'sonarscanner'
          ARTIFACT_NAME = "vprofile-v${buildnummer}.war"
          AWS_S3_BUCKET = 'eje-vpro-bean'
          AWS_EB_APP_NAME = 'eje-vpro-bean'
          AWS_EB_ENVIRONMENT_NAME = 'Ejevprobean-prod-env'
          AWS_EB_APP_VERSION = "${buildnummer}"
            
       }


       stages {         
           stage('Deploy to Stage pro bean'){
               steps {
                    withAWS(credentials: 'awscreds', region: 'eu-west-3') {
                    sh 'aws elasticbeanstalk update-environment --application-name $AWS_EB_APP_NAME --environment-name $AWS_EB_ENVIRONMENT_NAME --version-label $AWS_EB_APP_VERSION'   
                    }
               }

           }
           
          }
          post {
               always {
                    echo 'Slack Notifications'
                    slackSend channel: '#vpro-pro',
                    color: COLOR_MAP[currentBuild.currentResult],
                    message: "*${currentBuild.currentResult}:* Job ${env.JOB_NAME} build ${env.BUILD_NUMBER} \n More info at: ${env.BUILD_URL}"

               }
          }
       }
     
       
